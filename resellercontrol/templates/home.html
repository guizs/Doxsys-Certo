<!-- Ver icones no site https://feathericons.com/ -->
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.101.0">
    <title>DOXSYS</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='dashboard.css') }}">
    <!-- link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='home.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='sidebar.css') }}" -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
<!-- RETIRAR
<body onLoad="closeNav();"> -->
<body>
  <header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
    <a href="{{ url_for('home') }}">
      <img class="navbar-brand mt-0 mb-0 me-1 px-1" src="{{ url_for('static', filename='logo300x58.gif') }}" alt="Logo DOX">
    </a>

    {% if current_user.is_authenticated %}
      <button class="navbar-toggler position-absolute d-md-none collapsed" type="button"
              data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu"
              aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
    {% endif %}

    <div class="ms-auto d-flex align-items-center me-3">
      {% if current_user.is_authenticated %}
        <div class="dropdown">
          <a class="nav-link dropdown-toggle text-white" href="#" id="userDropdown" role="button"
             data-bs-toggle="dropdown" aria-expanded="false">
            {{ current_user.username }}
          </a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
            <li><a class="dropdown-item" href="{{ url_for('usredit', user_id=current_user.id) }}">Editar dados</a></li>
            {% if current_user.access >= 4 %}
               <li><a class="dropdown-item" href="{{ url_for('ajustes') }}">Ajustes do Sistema</a></li>
            {% endif %}
          </ul>
         </div>
        <a class="nav-link text-white ms-3" href="{{ url_for('sair') }}">[ Sair ]</a>
      {% else %}
        <a class="nav-link text-white" href="{{ url_for('login') }}">[ Login ]</a>
      {% endif %}
    </div>
  </header>

{% if current_user.is_authenticated %}
<div class="container-fluid">
  <div class="row">
    <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse" style="width:200px">
      <div class="position-sticky pt-3 sidebar-sticky">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link active" href="{{ url_for('doxsg')}}">
              <span data-feather="home" class="align-text-bottom"></span>
              DOX SG
            </a>
          </li>
          {% if current_user.is_authenticated and current_user.access >= 1 %}
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="{{ url_for('credenciais', status='ativo') }}">
              <span data-feather="file-text" class="align-text-bottom"></span>
              Credenciais
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('kbfaq')}}">
              <span data-feather="help-circle" class="align-text-bottom"></span>
              KB & Faq
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('versions')}}">
              <span data-feather="hash" class="align-text-bottom"></span>
              Versões
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('clientes')}}">
              <span data-feather="globe" class="align-text-bottom"></span>
              Clientes
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('pipeline', status='Ativo', vendr='00', mrkt='t', prodt='-', orderby='C')}}">
              <span data-feather="shopping-cart" class="align-text-bottom"></span>
              Pipeline
            </a>
          </li>
          {% if current_user.access >= 2 %}
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('propostas', orderby='n')}}">
              <span data-feather="plus-square" class="align-text-bottom"></span>
              Propostas
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('contratos', status='ativo', orderby='v')}}">
              <span data-feather="file" class="align-text-bottom"></span>
              Contratos
            </a>
          </li>
          {% endif %}
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="{{ url_for('projetos', status='ativo', orderby='p') }}">
              <span data-feather="list" class="align-text-bottom"></span>
              Projetos
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="{{ url_for('equipamentos', status='ativo') }}">
              <span data-feather="monitor" class="align-text-bottom"></span>
              Equipamentos
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('funcs', status='Ativo') }}">
              <span data-feather="users" class="align-text-bottom"></span>
              Funcionários
            </a>
          </li>
           {% if current_user.access >= 4 %}
                <li class="nav-item">
                  <a class="nav-link" href="{{ url_for('financ', status='t', tipo='t', mesatl=session['MESATL']) }}">
                  <span data-feather="dollar-sign" class="align-text-bottom"></span>Financeiro</a>
                </li>
           {% endif %}
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('users')}}">
              <span data-feather="user" class="align-text-bottom"></span>
              Usuários
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('links')}}">
              <span data-feather="link" class="align-text-bottom"></span>
              Links
            </a>
          </li>
        </ul>
        <ul class="nav flex-column mb-2">
          {% if current_user.access >= 2 %}
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('whatsapp')}}">
              <span data-feather="headphones" class="align-text-bottom"></span>
              WhatsApp
            </a>
          </li>
          <li class="nav-item">
              <a class="nav-link" href="{{ url_for('relatorios', mesatl=session['MESATL']) }}">
              <span data-feather="bar-chart-2" class="align-text-bottom"></span>Relatórios</a>
          </li>
          {% endif %}
          <li class="closebtn">
            <a class="nav-link" href="javascript:void(0)" onclick="closeNav()" style="text-decoration: none">
                <span data-feather="minimize-2" class="align-text-bottom"></span></a>
          </li>
          {% endif %}
        </ul>
      </div>
    </nav>
{% endif %}
    <main class="col-md-9 col-lg-10 px-md-4 main">
    <div class="container">
    {% with mensagens = get_flashed_messages(with_categories=True) %}
        {% if mensagens %}
            {% for categoria, mensagem in mensagens %}
                <div class="alert {{ categoria }}">
                    {{ mensagem }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    </div>

        {% block body %}
        <div id="main" style="width:1024px; margin-left:0;">
        <br>
        <!-- a href="javascript:void(0)" class="closebtn" onclick="openNav()" style="text-decoration: none">
                    <span data-feather="maximize-2" class="align-text-bottom"></span></a -->
        <div class="row">
            <div class="col-12 col-lg-6">
                <div style="display:flex; align-items:center; gap:10px">
                {% if current_user.is_authenticated %}
                    <a href="javascript:void(0)" class="closebtn" onclick="openNav()" style="text-decoration: none">
                        <span data-feather="maximize-2" class="align-text-bottom"></span>
                    </a>
                {% endif %}

                 <h1 class="h2">DOXSYS</h1><hr>
                </div>
                <img src="{{ url_for('static', filename='logo300x58.gif') }}" class="img-fluid">
                <h3>Soluções de Gerenciamento</h3>
            </div>
            <div class="col-12 col-lg-6">
                <h1 style="display:flex; align-items:baseline">Week:<p style="font-size:55px; margin:0"> {{ session["WEEK"] }} </p> <small> - {{ session["HOJE"] }} - {{ session["LOCALTIME"] }} </small> </h1>
                <h3>{{ session["TAIWAN_TZ"] }}={{ session["TAIWANTIME"] }} - {{ session["EUROPE_TZ"] }}={{ session["EUROPETIME"] }}</h3>
            </div>
        </div>
        {% if current_user.is_authenticated and current_user.access > 1 %}
            <HR>
            {% if aviso %}
             <!-- h4 style="color: #F00">{{ aviso[0] }}</h4 -->
             {% for avs in aviso %}
                {% if avs[2:3] == "D" %}
                    {% set cor = "color: #6988AF" %}
                {% elif avs[2:3] == "R" %}
                    {% set cor = "color: #AA0000" %}
                {% elif avs[2:3] == "G" %}
                    {% set cor = "color: #009900" %}
                {% elif avs[2:3] == "B" %}
                    {% set cor = "color: #000099" %}
                {% else %}
                    {% set cor = "color: #000" %}
                {% endif %}
                {% if avs[0:3] == "---" %}
                    <HR>
                {% elif avs[0:2] == "H1" %}
                    <h1 style="{{ cor }}">{{ avs[4:] }}</h1>
                {% elif avs[0:2] == "H2" %}
                    <h2 style="{{ cor }}">{{ avs[4:] }}</h2>
                {% elif avs[0:2] == "H3" %}
                    <h3 style="{{ cor }}">{{ avs[4:] }}</h3>
                {% elif avs[0:2] == "H4" %}
                    <h4 style="{{ cor }}">{{ avs[4:] }}</h4>
                {% elif avs[0:2] == "H5" %}
                    <h5 style="{{ cor }}">{{ avs[4:] }}</h5>
                {% else %}
                    <p>{{ avs }}</p>
                {% endif %}
             {% endfor %}
             <HR>
            {% endif %}
            <BR>
            <h4>Sistema Interno da DOXsg</h4>
            <h4>{{ app.name }} - {{ app.config['VERSION'] }}</h4>
            <!-- h5 style="color: #05A">{{ current_user.username }}</h5 -->
            <h5 style="color: #077">IP:{{ ipadr }} [Access:{{ current_user.access }}] {{ current_user.role }}</h5>
        {% endif %}
        <BR>
        {% if current_user.is_authenticated and current_user.access >= 3 %}
            <hr>
            <!-- h4>Usuários conectados: {{ connected_users }}</h4>
            {% for usr in connected_users %}
                <h5 style="color: #05A">Usr:{{ usr }}</h5><hr>
            {% endfor %} -->
            <!-- h5 style="color: #077">Logout time {{ app.permanent_session_lifetime }}</h5 -->
            <h3>Usuários que fizeram login hoje no escritório</h3>
            <table border="1" cellpadding="5" cellspacing="0">
                <thead>
                    <tr>
                        <th>Usuário</th>
                        <th>Horário de Login</th>
                    </tr>
                </thead>
                <tbody>
                    {% for username, horario in users_in %}
                    <tr>
                        <td>{{ username }}</td>
                        <td>{{ horario }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="2">Nenhum login do escritório registrado hoje.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <small><strong>{{ session["HOJE"] }} - IP DOX: {{ ipdox }}</strong></small>
            <br><br>
            <h3>Usuários que fizeram login fora do escritório </h3>
            <table border="1" cellpadding="5" cellspacing="0">
                <thead>
                    <tr>
                        <th>Usuário</th>
                        <th>Horário de Login</th>
                    </tr>
                </thead>
                <tbody>
                    {% for username, horario in users_out %}
                    <tr>
                        <td>{{ username }}</td>
                        <td>{{ horario }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="2">Nenhum login externo registrado hoje.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <small><strong>{{ session["HOJE"] }}</strong></small>
        {% endif %}
        </div>
        {% endblock %}
    </main>
  </div>
</div>

<script>
        function openNav() {
            document.getElementById(
                "sidebarMenu").style.width = "200px";
            document.getElementById(
                "main").style.marginLeft = "0px";
            document.getElementById(
                "header").style.marginLeft = "0px";
        }
        /* Set the width of the sidebar to 0
        and the left margin of the page content to 0 */
        function closeNav() {
            document.getElementById(
                "sidebarMenu").style.width = "0";
            document.getElementById(
                "main").style.marginLeft = "-190px";
            document.getElementById(
                "header").style.marginLeft = "-190px";
        }
</script>

<!-- script>
            function openNav() {
                document.getElementById(
                    "sidebarMenu").style.width = "200px";
                document.getElementById(
                    "sidebarMenu").style.paddingLeft = "20px";
                document.getElementById(
                    "main").style.marginLeft = "200px";
                let items = document.getElementsByClassName(
                    "item_name");

                for (let i = 0; i < items.length; i++) {
                    items[i].style.display = "block";
                }
            }

            /* Set the width of the sidebar to 0
            and the left margin of the page content to 0 */
            function closeNav() {
                document.getElementById(
                    "sidebarMenu").style.width = "40px";
                document.getElementById(
                    "sidebarMenu").style.paddingLeft = "10px";
                document.getElementById(
                    "main").style.marginLeft = "40px";
                let items = document.getElementsByClassName(
                    "item_name");

                for (let i = 0; i < items.length; i++) {
                    items[i].style.display = "none";
                }
            }

            let open = false
            let close = true

            function openAndClose(){
                if(open == true){
                    open = false
                    close = true
                    closeNav()
                }else{
                    open = true
                    close = false
                    openNav()
                }
            }
    </script -->

    <!-- Bootstrap bundle (inclui Popper.js) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" defer></script>

    <!-- Feather Icons -->
    <script src="{{ url_for('static', filename='feather.min.js') }}"></script>
    <script>
      function tryFeatherReplace(retries = 10) {
        if (window.feather && typeof feather.replace === 'function') {
          feather.replace();
        } else if (retries > 0) {
          setTimeout(() => tryFeatherReplace(retries - 1), 100);
        } else {
          console.warn("Feather icons não foram carregados corretamente.");
        }
      }

      if (document.readyState === "complete" || document.readyState === "interactive") {
        tryFeatherReplace();
      } else {
        document.addEventListener("DOMContentLoaded", tryFeatherReplace);
      }
    </script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js" integrity="sha384-zNy6FEbO50N+Cg5wap8IKA4M/ZnLJgzc6w2NqACZaK0u0FXfOWRRJOnQtpZun8ha" crossorigin="anonymous" defer></script>

    <script src="https://unpkg.com/feather-icons" defer></script>
    <script>
      feather.replace()
    </script>

  </body>
</html>
